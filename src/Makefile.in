#
# Makefile.in for services/services
#
# $Id: Makefile.in 603 2006-05-14 10:32:26Z michael $
#
@SET_MAKE@

CC		= @CC@
INSTALL		= @INSTALL@
INSTALL_BIN	= @INSTALL_PROGRAM@
INSTALL_DATA	= @INSTALL_DATA@
CFLAGS		= @IRCSERVICES_CFLAGS@ `perl -MExtUtils::Embed -e ccopts`
LDFLAGS   	= @LDFLAGS@ -llua5.1
MKDEP		= @MKDEP@
STDOUT		= @STDOUT@
MV		= @MV@
RM		= @RM@
SED		= @SED@
YACC		= @YACC@
LEX		= @LEX@
RUBY_CFLAGS = @RUBY_CFLAGS@
RUBY_LIBS = @RUBY_LIBS@

prefix		= @prefix@
exec_prefix	= $(DESTDIR)@exec_prefix@
bindir		= $(DESTDIR)@bindir@
sysconfdir	= $(DESTDIR)@sysconfdir@
localstatedir	= $(DESTDIR)@localstatedir@

# must not have whitespace here
CLOBBER=@CLOBBER@

# If you wish to change this, look in include/defaults.h also and change SPATH
PROGS		= services

SSL_LIBS	= @SSL_LIBS@
SSL_INCLUDES	= @SSL_INCLUDES@
IRCDLIBS	= @MODULES_LIBS@ @LIBS@ ../libio/libio.a $(SSL_LIBS)
INCLUDES	= -I../include -I../libio $(SSL_INCLUDES)
CPPFLAGS	= ${INCLUDES} @CPPFLAGS@

default:	all

y.tab.o:  y.tab.c conf/parser.y
	${CC} -DYYDEBUG ${CPPFLAGS} ${CFLAGS} -I. -c y.tab.c

# Note GNU bison uses <file>.tab.c not y.tab.c
y.tab.c:  conf/parser.y
	${YACC} -d conf/parser.y


lex.yy.o: y.tab.c lex.yy.c conf/lexer.l
	${CC} ${CPPFLAGS} ${CFLAGS} -I. -c lex.yy.c

lex.yy.c: conf/lexer.l
	${LEX} conf/lexer.l



SSL_SRCS = rsa.c

SRCS = 								\
 channel.c						\
 channel_mode.c				\
 conf/conf.c  				\
 conf/connect.c				\
 conf/database.c			\
 conf/modules.c				\
 conf/servicesinfo.c	\
 conf.c								\
 client.c							\
 crypt.c							\
 connection.c 				\
 dbm.c 		  					\
 hash.c								\
 hostmask.c						\
 interface.c					\
 language.c						\
 lua_module.c					\
 m_error.c						\
 packet.c							\
 parse.c							\
 perl_module.c				\
 ruby_module.c				\
 services.c						\
 send.c								\
 user.c

OBJS = ${SRCS:.c=.o}

all: .depend services

build: all

services: @MODULES_LIBS@ ../libio/libio.a lex.yy.o y.tab.o $(OBJS)
	${CC} ${CFLAGS} ${LDFLAGS} -o $@ ${OBJS} y.tab.o lex.yy.o ${IRCDLIBS} ${RUBY_LIBS} `perl -MExtUtils::Embed -e ldopts`

../libio/libio.a:
	cd ../libio && ${MAKE} ${MFLAGS}

install-mkdirs:
	mkdir -p $(DESTDIR)$(prefix) $(exec_prefix) $(bindir) $(sysconfdir) \
		$(localstatedir)/logs

install: install-mkdirs build
	@for i in $(PROGS); do \
		if test -f $(bindir)/$$i -a -z "$(CLOBBER)"; then \
			echo $(MV) $(bindir)/$$i $(bindir)/$$i.old; \
			$(MV) $(bindir)/$$i $(bindir)/$$i.old; \
		fi; \
		echo $(INSTALL_BIN) $$i $(bindir); \
		$(INSTALL_BIN) $$i $(bindir); \
	done

# this is really the default rule for c files
.c.o:
	${CC} ${CPPFLAGS} ${CFLAGS} ${RUBY_CFLAGS} -c -o ${<:.c=.o} $<

.depend:
	${MKDEP} ${CPPFLAGS} ${SRCS} ${STDOUT}
	@${SED} -e '/^# Autogenerated - do not delete/,$$d' <Makefile >Makefile.depend
	@echo "# Autogenerated - do not delete" >> Makefile.depend
	@echo "include .depend" >> Makefile.depend
	@${MV} Makefile.depend Makefile

clean:
	${RM} -f *.o conf/*.o *.exe *~ *core services lex.yy.c y.tab.*
distclean: clean
	${RM} -f Makefile .depend

.PHONY: clean distclean install install-mkdirs build
